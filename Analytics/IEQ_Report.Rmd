---
title: "Injustice Experience Questionnaire (IEQ)"
author: "Analytics Report generated by Sentient Psychometrics"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=2cm,right=2cm,top=1.5cm,bottom=1.2cm"
output:
  pdf_document:
    latex_engine: pdflatex
header-includes:
- \usepackage[fontsize=7.8pt]{scrextend}
- \usepackage{color}
- \usepackage{booktabs}
- \usepackage[table]{xcolor}
fontfamily: arev
always_allow_html: yes
params:
Imp_Df: 'NULL'
Sig_Imp_Df: 'NULL'
Scale_Report_Df: 'NULL'
Periods: 'NULL'
---


\begingroup\Large

\begin{center} \textbf{Information about the Injustice Experience Questionnaire (IEQ)} \end{center} 

#What it Measures: 

* Injury-related perceptions of injustice.

* Includes at least two components:(1) Perceived severity/irreparability of loss and (2) blame/unfairness.


#What Higher Scores Mean:

* Stronger perceptions on injustice relating to one's injury.

* Prospective research has shown that individuals with chronic pain who **score 30 or greater** on the IEQ are at increased risk of adverse mental health, poor rehabilitation outcomes and prolonged work disability (Ferrari, 2015; Scott, Milioto, Trost & Sullivan, 2016; Sullivan, Scott & Trost, 2012; Trost, Agtarap, Scott, Driver, Gluck et al., 2015; Yakobov, Scott & Tait, 2014). 


#Scale Quality:

* The IEQ has performed well in several studies examining its psychometric properties in a range of populations (Kennedy et al., 2014; Rodero, Luciano, Montero-Mar√≠n, Casanueva, Palacin et al., 2012). 

#Scale Structure: 

* 12-item scale

* Two subscales each compsing 6 items: (1) Severity/Irreparability of loss & (2) Blame/Unfairness.

* 5-Point Likert scale.

* Respondents indicate how frequently (0 = "never"; 4= "all the time") they experiences the thoughts and feelings listed (e.g. "It all seems so unfair"). 

* Research has supported a two-factor structure (Kennedy et al., 2014; Sullivan, 2008). 

\endgroup

\newpage

```{r, echo = FALSE, warning = FALSE, comment = NA, results = 'asis'}

    #IEQ nonsig calculations 
    
    IEQ_Imp_Df<-dplyr::select(Imp_Df, contains("IEQ.Fullscale"))
    Severity_Irreparability_Imp_Df<-dplyr::select(Imp_Df, contains("Severity.Irreparability"))
    Blame_Unfairness_Imp_Df<- dplyr::select(Imp_Df, contains("Blame.Unfairness"))
    
    IEQ_Imp_Df<-as.data.frame(gather(IEQ_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Severity_Irreparability_Imp_Df<-as.data.frame(gather(Severity_Irreparability_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Blame_Unfairness_Imp_Df<-as.data.frame(gather(Blame_Unfairness_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    
    
    #IEQ sig calculations
    
    
    IEQ_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("IEQ.Fullscale"))
    Severity_Irreparability_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("Severity.Irreparability"))
    Blame_Unfairness_Sig_Imp_Df<- dplyr::select(Sig_Imp_Df, contains("Blame.Unfairness"))
    
    IEQ_Sig_Imp_Df<-as.data.frame(gather(IEQ_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Severity_Irreparability_Sig_Imp_Df<-as.data.frame(gather(Severity_Irreparability_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Blame_Unfairness_Sig_Imp_Df<-as.data.frame(gather(Blame_Unfairness_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    
    Improvement_Type<- c("Improvement", "Statistically Reliable Improvement")
    
    Sig_Null<- data.frame(n = "NA", Percentage = "NA")
    
    
     if(nrow(IEQ_Imp_Df) == 1 & nrow(IEQ_Sig_Imp_Df) == 1) {
      IEQ_Percentages<- rbind(IEQ_Imp_Df, IEQ_Sig_Imp_Df)
      IEQ_Percentages<- cbind(Improvement_Type, IEQ_Percentages)
    }  else if(nrow(IEQ_Imp_Df) == 1 & nrow(IEQ_Sig_Imp_Df) == 0) {
      IEQ_Percentages = rbind(IEQ_Imp_Df, Sig_Null)
       IEQ_Percentages<- cbind(Improvement_Type, IEQ_Percentages)
    } else if(nrow(IEQ_Imp_Df) == 0) {
      IEQ_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      IEQ_Percentages<- cbind(Improvement_Type, IEQ_Percentages)
    }

     names(IEQ_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
    
    
    
    if(nrow(Severity_Irreparability_Imp_Df) == 1 & nrow(Severity_Irreparability_Sig_Imp_Df) == 1) {
      Severity_Irreparability_Percentages<- rbind(Severity_Irreparability_Imp_Df, Severity_Irreparability_Sig_Imp_Df)
      Severity_Irreparability_Percentages<- cbind(Improvement_Type, Severity_Irreparability_Percentages)
    }  else if(nrow(Severity_Irreparability_Imp_Df) == 1 & nrow(Severity_Irreparability_Sig_Imp_Df) == 0) {
      Severity_Irreparability_Percentages = rbind(Severity_Irreparability_Imp_Df, Sig_Null)
       Severity_Irreparability_Percentages<- cbind(Improvement_Type, Severity_Irreparability_Percentages)
    } else if(nrow(Severity_Irreparability_Imp_Df) == 0) {
      Severity_Irreparability_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      Severity_Irreparability_Percentages<- cbind(Improvement_Type, Severity_Irreparability_Percentages)
    }

     names(Severity_Irreparability_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
    
    
     if(nrow(Blame_Unfairness_Imp_Df) == 1 & nrow(Blame_Unfairness_Sig_Imp_Df) == 1) {
      Blame_Unfairness_Percentages<- rbind(Blame_Unfairness_Imp_Df, Blame_Unfairness_Sig_Imp_Df)
      Blame_Unfairness_Percentages<- cbind(Improvement_Type, Blame_Unfairness_Percentages)
    }  else if(nrow(Blame_Unfairness_Imp_Df) == 1 & nrow(Blame_Unfairness_Sig_Imp_Df) == 0) {
      Blame_Unfairness_Percentages = rbind(Blame_Unfairness_Imp_Df, Sig_Null)
       Blame_Unfairness_Percentages<- cbind(Improvement_Type, Blame_Unfairness_Percentages)
    } else if(nrow(Blame_Unfairness_Imp_Df) == 0) {
      Blame_Unfairness_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      Blame_Unfairness_Percentages<- cbind(Improvement_Type, Blame_Unfairness_Percentages)
    }

     names(Blame_Unfairness_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
     
     
    Scale_Names<- c("IEQ Total", "Severity Irreparability", "Blame Unfairness")
    
    IEQ_M_Intake<- Scale_Report_Df %>% select(contains("First.Score")) %>% select(contains("IEQ")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    IEQ_M_Discharge<- Scale_Report_Df %>% select(contains("Last.Score")) %>% select(contains("IEQ")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    IEQ_M_Change<- Scale_Report_Df %>% select(contains("Change")) %>% select(contains("IEQ")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    IEQ_Range<- c("Total Scale" = "0-48", "Severity Irreparability" = "0-24", "Blame Unfairness" = "0-24")

    
    IEQ_Descriptives<- rbind(IEQ_M_Intake, IEQ_M_Discharge, IEQ_M_Change, IEQ_Range)
    Data<- c("Mean Intake Score", "Mean Discharge Score", "Mean Change", "Range of Possible Scores")
    IEQ_Descriptives<- cbind(Data, IEQ_Descriptives)
  
```

##IEQ Total Scale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(IEQ_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) 
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
  
#IEQ Graph
    
    IEQ_Reformat<- dplyr::select(Scale_Report_Df, Name, IEQ.Fullscale.First.Score, IEQ.Fullscale.Last.Score)
    IEQ_Reformat<- IEQ_Reformat %>% rename(Pre = IEQ.Fullscale.First.Score, Post = IEQ.Fullscale.Last.Score)
    IEQ_Reformat<- IEQ_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    IEQ_Reformat<- gather(IEQ_Reformat, Group, IEQ.Total.Score, Pre:Post)
    IEQ_Reformat$Group<- factor(IEQ_Reformat$Group, levels=unique(IEQ_Reformat$Group))
    
    IEQ_Plot<- ggplot(data = IEQ_Reformat, aes (x = factor(Group), y = IEQ.Total.Score, group = Name))
    IEQ_Plot<- IEQ_Plot + geom_line() + xlab("Time") + ylab("IEQ Total") 
    
    IEQ_Plot + scale_y_continuous(limits = c(0, 48), breaks = c(0,12,24,36,48)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
```

##Severity Irreparability Subscale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(Severity_Irreparability_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T)
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
IEQ_Severity_Irreparability_Reformat<- dplyr::select(Scale_Report_Df, Name, IEQ.Severity.Irreparability.First.Score, IEQ.Severity.Irreparability.Last.Score)
    IEQ_Severity_Irreparability_Reformat<- IEQ_Severity_Irreparability_Reformat %>% rename(Pre = IEQ.Severity.Irreparability.First.Score, Post = IEQ.Severity.Irreparability.Last.Score)
    IEQ_Severity_Irreparability_Reformat<- IEQ_Severity_Irreparability_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    IEQ_Severity_Irreparability_Reformat<- gather(IEQ_Severity_Irreparability_Reformat, Group, IEQ.Severity.Irreparability.Score, Pre:Post)
    IEQ_Severity_Irreparability_Reformat$Group<- factor(IEQ_Severity_Irreparability_Reformat$Group, levels=unique(IEQ_Severity_Irreparability_Reformat$Group))
    
    IEQ_Severity_Irreparability_Plot<- ggplot(data = IEQ_Severity_Irreparability_Reformat, aes(x = factor(Group), y = IEQ.Severity.Irreparability.Score, group = Name))
    IEQ_Severity_Irreparability_Plot<- IEQ_Severity_Irreparability_Plot + geom_line() + xlab("Time") + ylab("Severity Irreparability") 
    
    IEQ_Severity_Irreparability_Plot + scale_y_continuous(limits = c(0, 24), breaks = c(0,8,16,24)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
    

```

##Blame Unfairness Subscale 

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(Blame_Unfairness_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T)

```

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis', fig.width = 4, fig.height = 1.9, fig.align='left'}
IEQ_Blame_Unfairness_Reformat<- dplyr::select(Scale_Report_Df, Name, IEQ.Blame.Unfairness.First.Score, IEQ.Blame.Unfairness.Last.Score)
    IEQ_Blame_Unfairness_Reformat<- IEQ_Blame_Unfairness_Reformat %>% rename(Pre = IEQ.Blame.Unfairness.First.Score, Post = IEQ.Blame.Unfairness.Last.Score)
    IEQ_Blame_Unfairness_Reformat<- IEQ_Blame_Unfairness_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    IEQ_Blame_Unfairness_Reformat<- gather(IEQ_Blame_Unfairness_Reformat, Group, IEQ.Blame.Unfairness.Score, Pre:Post)
    IEQ_Blame_Unfairness_Reformat$Group<- factor(IEQ_Blame_Unfairness_Reformat$Group, levels=unique(IEQ_Blame_Unfairness_Reformat$Group))
    
    IEQ_Blame_Unfairness_Plot<- ggplot(data = IEQ_Blame_Unfairness_Reformat, aes (x = factor(Group), y = IEQ.Blame.Unfairness.Score, group = Name))
    IEQ_Blame_Unfairness_Plot<- IEQ_Blame_Unfairness_Plot + geom_line() + xlab("Time") + ylab("Blame Unfairness") 
    
    IEQ_Blame_Unfairness_Plot + scale_y_continuous(limits = c(0, 24), breaks = c(0,8,16,24)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
```

##Average Change Over Treatment Period

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(IEQ_Descriptives, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) %>% column_spec(1, width = "6cm")

```

##Reporting Period
```{r,echo = FALSE,warning=FALSE,comment = NA, results='asis'}


if(!is.null(Periods)) {
  cat(Periods, sep = ", ")
} else if (is.null(Periods)) {
  cat("No reporting period was specified. All cases with complete IEQ data were used.")
}


```