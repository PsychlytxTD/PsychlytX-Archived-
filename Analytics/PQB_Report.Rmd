---
title: "Prodromal Questionnaire - Brief (PQ-B)"
author: "Analytics Report generated by Sentient Psychometrics"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=2cm,right=2cm,top=1.5cm,bottom=1.2cm"
output:
  pdf_document:
    latex_engine: pdflatex
header-includes:
- \usepackage[fontsize=7.8pt]{scrextend}
- \usepackage{color}
- \usepackage{booktabs}
- \usepackage[table]{xcolor}
fontfamily: arev
always_allow_html: yes
params:
Imp_Df: 'NULL'
Sig_Imp_Df: 'NULL'
Scale_Report_Df: 'NULL'
Periods: 'NULL'
---

\begingroup\Large

\begin{center} \textbf{Information about the Prodromal Questionnaire - Brief (PQ-B)} \end{center} 

#What it Measures: 

* Attenuated positive symptoms, indicating risk for psychosis (also known as Psychosis-Like Experiences; PLEs) 

* Distress and impairment associated with Psychosis-Like Experiences.

* The PQ-B was developed to identify young people at ultra high risk (UHR) for a psychotic disorder. 

* The PQ-B **does NOT** diagnose a psychosis prodrome. It is intended to be followed by an interview-based assessment with a trained clinician. 

#What Higher Scores Mean:

* Higher scores on the total scale indicate that the individual is experiencing a wider range of attenuated positive symptoms. 

* Higher scores on the distress subscale indicate that the individual is more distressed/impaired as a result of attenuated positive symptoms.

* Higher scores on the total scale and distress subscale suggest **increased risk for developing a psychotic disorder.** However, it is important to note that amoung the general population, psychotic-like experiences can be present in up to 20% of adults, frequently in the absence of a full psychotic disorder (Hanssen et al., 2003). Importantly, individuals who are more distressed by psychotic-like experiences appear at greater risk for the development of a psychotic disorder.

#Scale Quality:

* Psychometric research supports the PQ-B, which is widely used, as a reliable tool for identifying adolescents at risk for psychosis (Fonseca-Pedrero, Gooding, Ortu√±o-Sierra & Paino, 2016). 

#Scale Structure:

* Contains 21 items. Each item is paired with a distress item. 

* Total scale items are presented in Yes/No format. Distress items are presented on a 5-point Likert scale.

* Respondents answer "yes" or "no" as to whether they experience a psychotic-like experience (e.g. "Do you feel that other people are watching you or talking about you?"). 

* If a "yes" answer is provided, respondents must indicate how much they find the experience frightening or problematic (1 = "strongly disagree"; 5 = "strongly agree"). 

* Yes/No scores and distress scores are summed to form a total scale and distress subscale respectively. 

\endgroup

\newpage 

```{r, echo = FALSE, warning = FALSE, comment = NA, results = 'asis'}

    #PQB nonsig calculations 
    
    PQB_Imp_Df<-dplyr::select(Imp_Df, contains("PQB.Fullscale"))
    Distress_Imp_Df<-dplyr::select(Imp_Df, contains("PQB.Distress"))

    PQB_Imp_Df<-as.data.frame(gather(PQB_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Distress_Imp_Df<-as.data.frame(gather(Distress_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))

    
    #PQB sig calculations
    
    
    PQB_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("PQB.Fullscale"))
    Distress_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("PQB.Distress"))
    
    PQB_Sig_Imp_Df<-as.data.frame(gather(PQB_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Distress_Sig_Imp_Df<-as.data.frame(gather(Distress_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))

    
    Improvement_Type<- c("Improvement", "Statistically Reliable Improvement")
    
    Sig_Null<- data.frame(n = "NA", Percentage = "NA")
    
    
     if(nrow(PQB_Imp_Df) == 1 & nrow(PQB_Sig_Imp_Df) == 1) {
      PQB_Percentages<- rbind(PQB_Imp_Df, PQB_Sig_Imp_Df)
      PQB_Percentages<- cbind(Improvement_Type, PQB_Percentages)
    }  else if(nrow(PQB_Imp_Df) == 1 & nrow(PQB_Sig_Imp_Df) == 0) {
      PQB_Percentages = rbind(PQB_Imp_Df, Sig_Null)
       PQB_Percentages<- cbind(Improvement_Type, PQB_Percentages)
    } else if(nrow(PQB_Imp_Df) == 0) {
      PQB_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      PQB_Percentages<- cbind(Improvement_Type, PQB_Percentages)
    }

     names(PQB_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
    
    
    
    if(nrow(Distress_Imp_Df) == 1 & nrow(Distress_Sig_Imp_Df) == 1) {
      Distress_Percentages<- rbind(Distress_Imp_Df, Distress_Sig_Imp_Df)
      Distress_Percentages<- cbind(Improvement_Type, Distress_Percentages)
    }  else if(nrow(Distress_Imp_Df) == 1 & nrow(Distress_Sig_Imp_Df) == 0) {
      Distress_Percentages = rbind(Distress_Imp_Df, Sig_Null)
       Distress_Percentages<- cbind(Improvement_Type, Distress_Percentages)
    } else if(nrow(Distress_Imp_Df) == 0) {
      Distress_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      Distress_Percentages<- cbind(Improvement_Type, Distress_Percentages)
    }

     names(Distress_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    

     
    Scale_Names<- c("PQ-B Total", "Distress")
    
    PQB_M_Intake<- Scale_Report_Df %>% select(contains("First.Score")) %>% select(contains("PQB")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PQB_M_Discharge<- Scale_Report_Df %>% select(contains("Last.Score")) %>% select(contains("PQB")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PQB_M_Change<- Scale_Report_Df %>% select(contains("Change")) %>% select(contains("PQB")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PQB_Range<- c("Total Scale" = "0-21", "Distress" = "0-105")

    
    PQB_Descriptives<- rbind(PQB_M_Intake, PQB_M_Discharge, PQB_M_Change, PQB_Range)
    Data<- c("Mean Intake Score", "Mean Discharge Score", "Mean Change", "Range of Possible Scores")
    PQB_Descriptives<- cbind(Data, PQB_Descriptives)
  
```

##PQ-B Total Scale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(PQB_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) 
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
  
#PQB Graph
    
    PQB_Reformat<- dplyr::select(Scale_Report_Df, Name, PQB.Fullscale.First.Score, PQB.Fullscale.Last.Score)
    PQB_Reformat<- PQB_Reformat %>% rename(Pre = PQB.Fullscale.First.Score, Post = PQB.Fullscale.Last.Score)
    PQB_Reformat<- PQB_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    PQB_Reformat<- gather(PQB_Reformat, Group, PQB.Total.Score, Pre:Post)
    PQB_Reformat$Group<- factor(PQB_Reformat$Group, levels=unique(PQB_Reformat$Group))
    
    PQB_Plot<- ggplot(data = PQB_Reformat, aes (x = factor(Group), y = PQB.Total.Score, group = Name))
    PQB_Plot<- PQB_Plot + geom_line() + xlab("Time") + ylab("PQ-B Total") 
    
    PQB_Plot + scale_y_continuous(limits = c(0, 21), breaks = c(0,7,14,21)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
```

##Distress Subscale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(Distress_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T)
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
PQB_Distress_Reformat<- dplyr::select(Scale_Report_Df, Name, PQB.Distress.First.Score, PQB.Distress.Last.Score)
    PQB_Distress_Reformat<- PQB_Distress_Reformat %>% rename(Pre = PQB.Distress.First.Score, Post = PQB.Distress.Last.Score)
    PQB_Distress_Reformat<- PQB_Distress_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    PQB_Distress_Reformat<- gather(PQB_Distress_Reformat, Group, PQB.Distress.Score, Pre:Post)
    PQB_Distress_Reformat$Group<- factor(PQB_Distress_Reformat$Group, levels=unique(PQB_Distress_Reformat$Group))
    
    PQB_Distress_Plot<- ggplot(data = PQB_Distress_Reformat, aes(x = factor(Group), y = PQB.Distress.Score, group = Name))
    PQB_Distress_Plot<- PQB_Distress_Plot + geom_line() + xlab("Time") + ylab("Distress") 
    
    PQB_Distress_Plot + scale_y_continuous(limits = c(0, 105), breaks = c(0,25,50,75,105)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
    

```


##Average Change Over Treatment Period

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(PQB_Descriptives, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) %>% column_spec(1, width = "6cm")

```

##Reporting Period
```{r,echo = FALSE,warning=FALSE,comment = NA, results='asis'}


if(!is.null(Periods)) {
  cat(Periods, sep = ", ")
} else if (is.null(Periods)) {
  cat("No reporting period was specified. All cases with complete PQ-B data were used.")
}


```