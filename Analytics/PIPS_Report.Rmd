---
title: "Psychological Inflexibility in Pain Scale (PIPS)"
author: "Analytics Report generated by Sentient Psychometrics"
date: "`r format(Sys.time(), '%d %B, %Y')`"
geometry: "left=2cm,right=2cm,top=1.5cm,bottom=1.2cm"
output:
  pdf_document:
    latex_engine: pdflatex
header-includes:
- \usepackage[fontsize=7.8pt]{scrextend}
- \usepackage{color}
- \usepackage{booktabs}
- \usepackage[table]{xcolor}
fontfamily: arev
always_allow_html: yes
params:
Imp_Df: 'NULL'
Sig_Imp_Df: 'NULL'
Scale_Report_Df: 'NULL'
Periods: 'NULL'
---

\begingroup\Large

\begin{center} \textbf{Information About the Psychological Inflexibility in Pain Scale (PIPS)} \end{center} 

#What it Measures: 

* Symptoms of psychological inflexibility in response to pain. Subscale names appear bold below in parentheses. 


* The tendency to engage in particular behaviours that result in avoidance of pain and related distress **(Avoidance)**.


* Frequency of thoughts which, if acted upon, would be likely to lead to avoidance behaviours **(Pain Thought Fusion)**.


#What Higher Scores Mean:

* Greater psychological inflexibility in responding to pain. 


#Scale Quality:

* The PIPS has displayed acceptable psychometric properties across several validation studies and appears responsive to change (Barke, Riecke, Rief & Glombiewski, 2015; Wicksell, Lekander, Sorjonen & Olsson, 2010). 

#Scale Structure:

* 12 items.


* 7-point Likert scale.


* Respondents indicate how much (1 = "Never true"; 7 = "Always true") each statement is true for them (e.g. "When I am in pain, I stay away from other people"). 

\endgroup


\newpage 

```{r, echo = FALSE, warning = FALSE, comment = NA, results = 'asis'}

    #PIPS nonsig calculations 
    
    PIPS_Imp_Df<-dplyr::select(Imp_Df, contains("PIPS.Fullscale"))
    Pain_Avoidance_Imp_Df<-dplyr::select(Imp_Df, contains("PIPS.Pain.Avoidance"))
    Pain_Fusion_Imp_Df<- dplyr::select(Imp_Df, contains("PIPS.Pain.Fusion"))
    
    PIPS_Imp_Df<-as.data.frame(gather(PIPS_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Pain_Avoidance_Imp_Df<-as.data.frame(gather(Pain_Avoidance_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Pain_Fusion_Imp_Df<-as.data.frame(gather(Pain_Fusion_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    
    
    #PIPS sig calculations
    
    
    PIPS_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("PIPS.Fullscale"))
    Pain_Avoidance_Sig_Imp_Df<-dplyr::select(Sig_Imp_Df, contains("PIPS.Pain.Avoidance"))
    Pain_Fusion_Sig_Imp_Df<- dplyr::select(Sig_Imp_Df, contains("PIPS.Pain.Fusion"))
    
    PIPS_Sig_Imp_Df<-as.data.frame(gather(PIPS_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Pain_Avoidance_Sig_Imp_Df<-as.data.frame(gather(Pain_Avoidance_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    Pain_Fusion_Sig_Imp_Df<-as.data.frame(gather(Pain_Fusion_Sig_Imp_Df, "Outcome", "Value") %>% na.omit() %>% count(Outcome,Value) %>% mutate(Percentage = paste0(round(100 * n/sum(n), 0), "%"))) %>% dplyr::filter(Value == "Yes") %>% dplyr::select(-c(Outcome,Value))
    
    Improvement_Type<- c("Improvement", "Statistically Reliable Improvement")
    
    Sig_Null<- data.frame(n = "NA", Percentage = "NA")
    
    
     if(nrow(PIPS_Imp_Df) == 1 & nrow(PIPS_Sig_Imp_Df) == 1) {
      PIPS_Percentages<- rbind(PIPS_Imp_Df, PIPS_Sig_Imp_Df)
      PIPS_Percentages<- cbind(Improvement_Type, PIPS_Percentages)
    }  else if(nrow(PIPS_Imp_Df) == 1 & nrow(PIPS_Sig_Imp_Df) == 0) {
      PIPS_Percentages = rbind(PIPS_Imp_Df, Sig_Null)
       PIPS_Percentages<- cbind(Improvement_Type, PIPS_Percentages)
    } else if(nrow(PIPS_Imp_Df) == 0) {
      PIPS_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      PIPS_Percentages<- cbind(Improvement_Type, PIPS_Percentages)
    }

     names(PIPS_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
    
    
    
    if(nrow(Pain_Avoidance_Imp_Df) == 1 & nrow(Pain_Avoidance_Sig_Imp_Df) == 1) {
      Pain_Avoidance_Percentages<- rbind(Pain_Avoidance_Imp_Df, Pain_Avoidance_Sig_Imp_Df)
      Pain_Avoidance_Percentages<- cbind(Improvement_Type, Pain_Avoidance_Percentages)
    }  else if(nrow(Pain_Avoidance_Imp_Df) == 1 & nrow(Pain_Avoidance_Sig_Imp_Df) == 0) {
      Pain_Avoidance_Percentages = rbind(Pain_Avoidance_Imp_Df, Sig_Null)
       Pain_Avoidance_Percentages<- cbind(Improvement_Type, Pain_Avoidance_Percentages)
    } else if(nrow(Pain_Avoidance_Imp_Df) == 0) {
      Pain_Avoidance_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      Pain_Avoidance_Percentages<- cbind(Improvement_Type, Pain_Avoidance_Percentages)
    }

     names(Pain_Avoidance_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
    
    
     if(nrow(Pain_Fusion_Imp_Df) == 1 & nrow(Pain_Fusion_Sig_Imp_Df) == 1) {
      Pain_Fusion_Percentages<- rbind(Pain_Fusion_Imp_Df, Pain_Fusion_Sig_Imp_Df)
      Pain_Fusion_Percentages<- cbind(Improvement_Type, Pain_Fusion_Percentages)
    }  else if(nrow(Pain_Fusion_Imp_Df) == 1 & nrow(Pain_Fusion_Sig_Imp_Df) == 0) {
      Pain_Fusion_Percentages = rbind(Pain_Fusion_Imp_Df, Sig_Null)
       Pain_Fusion_Percentages<- cbind(Improvement_Type, Pain_Fusion_Percentages)
    } else if(nrow(Pain_Fusion_Imp_Df) == 0) {
      Pain_Fusion_Percentages<- data.frame(x = c("NA", "NA"), y = c("NA", "NA"))
      Pain_Fusion_Percentages<- cbind(Improvement_Type, Pain_Fusion_Percentages)
    }

     names(Pain_Fusion_Percentages)<- c( "", "Number of Cases Improved", "Percentage of Cases Improved")
    
     
     
    Scale_Names<- c("PIPS Total", "Pain Avoidance", "Pain Thought Fusion")
    
    PIPS_M_Intake<- Scale_Report_Df %>% select(contains("First.Score")) %>% select(contains("PIPS")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PIPS_M_Discharge<- Scale_Report_Df %>% select(contains("Last.Score")) %>% select(contains("PIPS")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PIPS_M_Change<- Scale_Report_Df %>% select(contains("Change")) %>% select(contains("PIPS")) %>% summarise_all(funs(round(mean(., na.rm = TRUE), digits = 2))) %>% rename_all(funs(c(Scale_Names)))
    PIPS_Range<- c("Total Scale" = "0-120", "Activity Engagement" = "0-54", "Pain Willingness" = "0-66")

    
    PIPS_Descriptives<- rbind(PIPS_M_Intake, PIPS_M_Discharge, PIPS_M_Change, PIPS_Range)
    Data<- c("Mean Intake Score", "Mean Discharge Score", "Mean Change", "Range of Possible Scores")
    PIPS_Descriptives<- cbind(Data, PIPS_Descriptives)
  
```

##PIPS Total Scale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(PIPS_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) 
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
  
#PIPS Graph
    
    PIPS_Reformat<- dplyr::select(Scale_Report_Df, Name, PIPS.Fullscale.First.Score, PIPS.Fullscale.Last.Score)
    PIPS_Reformat<- PIPS_Reformat %>% rename(Pre = PIPS.Fullscale.First.Score, Post = PIPS.Fullscale.Last.Score)
    PIPS_Reformat<- PIPS_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    PIPS_Reformat<- gather(PIPS_Reformat, Group, PIPS.Total.Score, Pre:Post)
    PIPS_Reformat$Group<- factor(PIPS_Reformat$Group, levels=unique(PIPS_Reformat$Group))
    
    PIPS_Plot<- ggplot(data = PIPS_Reformat, aes (x = factor(Group), y = PIPS.Total.Score, group = Name))
    PIPS_Plot<- PIPS_Plot + geom_line() + xlab("Time") + ylab("PIPS Total") 
    
    PIPS_Plot + scale_y_continuous(limits = c(12, 84), breaks = c(12,24,36,48,60,72,84)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
```

##Pain Avoidance Subscale

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(Pain_Avoidance_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T)
```

```{r,echo=FALSE,warning=FALSE,comment=NA, fig.width = 4, fig.height = 1.9, fig.align='left'}
PIPS_Pain_Avoidance_Reformat<- dplyr::select(Scale_Report_Df, Name, PIPS.Pain.Avoidance.First.Score, PIPS.Pain.Avoidance.Last.Score)
    PIPS_Pain_Avoidance_Reformat<- PIPS_Pain_Avoidance_Reformat %>% rename(Pre = PIPS.Pain.Avoidance.First.Score, Post = PIPS.Pain.Avoidance.Last.Score)
    PIPS_Pain_Avoidance_Reformat<- PIPS_Pain_Avoidance_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    PIPS_Pain_Avoidance_Reformat<- gather(PIPS_Pain_Avoidance_Reformat, Group, PIPS.Pain.Avoidance.Score, Pre:Post)
    PIPS_Pain_Avoidance_Reformat$Group<- factor(PIPS_Pain_Avoidance_Reformat$Group, levels=unique(PIPS_Pain_Avoidance_Reformat$Group))
    
    PIPS_Pain_Avoidance_Plot<- ggplot(data = PIPS_Pain_Avoidance_Reformat, aes(x = factor(Group), y = PIPS.Pain.Avoidance.Score, group = Name))
    PIPS_Pain_Avoidance_Plot<- PIPS_Pain_Avoidance_Plot + geom_line() + xlab("Time") + ylab("Pain Avoidance") 
    
    PIPS_Pain_Avoidance_Plot + scale_y_continuous(limits = c(0, 56), breaks = c(0,8,16,24,32,40,48,56)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
    

```

##Pain Thought Fusion Subscale 

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(Pain_Fusion_Percentages, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T)

```

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis', fig.width = 4, fig.height = 1.9, fig.align='left'}
PIPS_Pain_Fusion_Reformat<- dplyr::select(Scale_Report_Df, Name, PIPS.Pain.Fusion.First.Score, PIPS.Pain.Fusion.Last.Score)
    PIPS_Pain_Fusion_Reformat<- PIPS_Pain_Fusion_Reformat %>% rename(Pre = PIPS.Pain.Fusion.First.Score, Post = PIPS.Pain.Fusion.Last.Score)
    PIPS_Pain_Fusion_Reformat<- PIPS_Pain_Fusion_Reformat %>% dplyr::filter(complete.cases(Pre, Post))

    PIPS_Pain_Fusion_Reformat<- gather(PIPS_Pain_Fusion_Reformat, Group, PIPS.Pain.Fusion.Score, Pre:Post)
    PIPS_Pain_Fusion_Reformat$Group<- factor(PIPS_Pain_Fusion_Reformat$Group, levels=unique(PIPS_Pain_Fusion_Reformat$Group))
    
    PIPS_Pain_Fusion_Plot<- ggplot(data = PIPS_Pain_Fusion_Reformat, aes (x = factor(Group), y = PIPS.Pain.Fusion.Score, group = Name))
    PIPS_Pain_Fusion_Plot<- PIPS_Pain_Fusion_Plot + geom_line() + xlab("Time") + ylab("Pain Fusion") 
    
    PIPS_Pain_Fusion_Plot + scale_y_continuous(limits = c(0, 28), breaks = c(4,8,12,16,20,24,28)) + scale_x_discrete(expand = c(0.2, 0)) + theme_bw() + theme(panel.background = element_rect("#f1f1f1"), axis.line = element_line(colour = "black"), panel.border = element_rect(colour = "#00004c", fill=NA, size=3)) + theme(axis.text.x =  element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.text.y = element_text(size=9, family = "AvantGarde", color = "black", face = "bold"), axis.title.x = element_text(size=9, family = "AvantGarde", face = "bold"), axis.title.y = element_text(size=9, family = "AvantGarde", face = "bold")) 
```

##Average Change Over Treatment Period

```{r,echo=FALSE,warning=FALSE,comment=NA,results='asis'}

kable(PIPS_Descriptives, booktabs = T, format = "latex") %>% kable_styling(position = "left", full_width = T, latex_options = "striped") %>% row_spec(0, bold = T) %>% column_spec(1, width = "6cm")

```

##Reporting Period
```{r,echo = FALSE,warning=FALSE,comment = NA, results='asis'}


if(!is.null(Periods)) {
  cat(Periods, sep = ", ")
} else if (is.null(Periods)) {
  cat("No reporting period was specified. All cases with complete PIPS data were used.")
}


```